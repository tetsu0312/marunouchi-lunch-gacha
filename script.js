// ==============================
// çŠ¶æ…‹ç®¡ç†ç”¨ã®å¤‰æ•°
// ==============================

// ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œã€çµæœè¡¨ç¤ºå‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ã‚¿ãƒ¼ãƒ³
const spinningMessages = [
  "ã‚¬ãƒãƒ£å›ã—ä¸­â€¦ğŸ˜‹",
  "ä»Šæ—¥ã®ãƒ©ãƒ³ãƒã‚’é¸ã³ã‚ˆã‚‹ã‚ˆã€œğŸ´",
  "ãŠè…¹ã™ã„ã¦ããŸã°ã„â€¦ğŸ¤¤",
  "ã†ã¾ã‹åº—ã‚’æ¢ã—ã‚ˆã‚‹ã‘ã‚“ã­ğŸ‘€",
  "ä»Šæ—¥ã¯ã“ã“ã‹ã‚‚â€¦ï¼ŸğŸ¤”",
  "ãƒ©ãƒ³ãƒã®é‹å‘½ã€å›è»¢ä¸­ğŸ°",
  "ä¸¸ã®å†…ãƒ©ãƒ³ãƒä¼šè­°ä¸­ğŸ“",
  "èƒƒè¢‹ã¨ç›¸è«‡ã—ã‚ˆã‚‹â€¦ğŸ˜†",
  "è¿·ã„ã«è¿·ã£ã¨ã‚‹ã°ã„â€¦ğŸŒ€",
  "ãˆãˆåº—å¼•ãäºˆæ„Ÿã—ã‹ã—ãªã„âœ¨",

  "ä»Šæ—¥ã®æ°—åˆ†ã‚’åˆ†æä¸­ğŸ“Š",
  "ãŠæ˜¼ã®æ­£è§£ã€æ¢ã—ä¸­ğŸ”",
  "ãƒ©ãƒ³ãƒãƒ¬ãƒ¼ãƒ€ãƒ¼èµ·å‹•ä¸­ğŸ“¡",
  "ç›´æ„Ÿã‚’ä¿¡ã˜ã‚‹ã‹æ‚©ã¿ä¸­ğŸ¤¯",
  "ç¾å‘³ã—ã•ã‚»ãƒ³ã‚µãƒ¼åå¿œä¸­âš¡",
  "ä»Šæ—¥ã®èƒƒè¢‹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ç¢ºèªä¸­ğŸ©º",
  "ãƒ©ãƒ³ãƒè„³ãƒ•ãƒ«å›è»¢ä¸­ğŸ§ ",
  "åˆå¾Œã‚’æ•‘ã†ä¸€çš¿ã‚’æ¢ç´¢ä¸­ğŸ½ï¸",
  "æº€è¶³åº¦MAXã‚’ç‹™ã„ã‚ˆã‚‹ğŸ¯",
  "å¤±æ•—ã›ã‚“ãƒ©ãƒ³ãƒã‚’é¸åˆ¥ä¸­ğŸ›¡ï¸",

  "ä»Šæ—¥ã‚‚å¹³å’Œã«ãƒ©ãƒ³ãƒã—ãŸã‹ã­ğŸ€",
  "åˆå¾Œã‚‚é ‘å¼µã‚Œã‚‹åº—ã‚’æ¢ã—ã‚ˆã‚‹ğŸ’ª",
  "ãŠè…¹ã¨å¿ƒã®ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ä¸­âš–ï¸",
  "ä»Šé£Ÿã¹ã‚‹ã¹ãåº—ã‚’æŠ½å‡ºä¸­ğŸ§ª",
  "ãƒ©ãƒ³ãƒå€™è£œã‚’ãµã‚‹ã„ã«ã‹ã‘ã‚ˆã‚‹ğŸ§º",
  "ç›´æ„Ÿ vs ç†æ€§ã€å¯¾æˆ¦ä¸­âš”ï¸",
  "ä»Šæ—¥ã®è‡ªåˆ†ã«å„ªã—ã„åº—ã‚’æ¢ã—ä¸­ğŸ˜Š",
  "åˆå¾Œã®é›†ä¸­åŠ›ã‚’è³­ã‘ãŸä¸€æŠä¸­ğŸ”¥",
  "æº€è…¹æœªæ¥ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ğŸ”®",
  "å¾Œæ‚”ã›ã‚“ãƒ©ãƒ³ãƒã‚’è¨ˆç®—ä¸­ğŸ“",

  "ä»Šæ—¥ã®ãƒ™ã‚¹ãƒˆãƒ©ãƒ³ãƒã‚’å¬å–šä¸­ğŸª„",
  "ãƒ©ãƒ³ãƒã®ç¥æ§˜ã«ãŠé¡˜ã„ä¸­ğŸ™",
  "é‹å‘½ã®ä¸€çš¿ã€æº–å‚™ä¸­ğŸ›",
  "ä»Šæ—¥ã®æ¥½ã—ã¿ã€ç”Ÿæˆä¸­ğŸ",
  "ãƒ©ãƒ³ãƒçµæœã€ã‚‚ã†ã™ãã°ã„â³",
  "ãƒ¯ã‚¯ãƒ¯ã‚¯ãŒæ­¢ã¾ã‚‰ã‚“ğŸ˜†ğŸ’“",
  "èƒƒè¢‹ãŒã–ã‚ã¤ã„ã¨ã‚‹â€¦ğŸ˜³",
  "ãã‚ãã‚æ±ºã¾ã‚Šãã†â€¦ğŸ‘‚",
  "æœŸå¾…å€¤ãŒä¸ŠãŒã‚Šã‚ˆã‚‹ğŸ“ˆ",
  "ã‚‚ã†ã¡ã‚‡ã„å¾…ã£ã¦ã­ã€œğŸ¾"
];

// ã‚¬ãƒãƒ£ãŒå›è»¢ä¸­ã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹ãƒ•ãƒ©ã‚°
let isSpinning = false;

// JSONã‹ã‚‰èª­ã¿è¾¼ã‚“ã ãƒ©ãƒ³ãƒä¸€è¦§ã‚’å…¥ã‚Œã‚‹é…åˆ—
let lunchList = [];

// å‰å›é¸ã°ã‚ŒãŸåº—èˆ—ã‚’ä¿æŒ
let lastShop = null;

// ã‚¬ãƒãƒ£ãƒœã‚¿ãƒ³ã®DOMè¦ç´ ã‚’å–å¾—
const button = document.getElementById("gachaBtn");

// çµæœã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
const result = document.getElementById("result");

// ==============================
// ãƒ©ãƒ³ãƒãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰ã‚’èª­ã¿è¾¼ã‚€
// ==============================

// lunch_list.json ã‚’å–å¾—ã—ã¦ JavaScript ã§ä½¿ãˆã‚‹å½¢ã«å¤‰æ›
fetch("lunch_list.json")
  .then(response => response.json())
  .then(data => {
    // JSONã®ä¸­èº«ã‚’ lunchList ã«ä¿å­˜
    lunchList = data;
  });

// ==============================
// ã‚¬ãƒãƒ£ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
// ==============================

button.addEventListener("click", () => {
  // ã‚¬ãƒãƒ£å›è»¢ä¸­ãªã‚‰ä½•ã‚‚ã—ãªã„ï¼ˆé€£æ‰“é˜²æ­¢ï¼‰
  if (isSpinning) return;

  // ãƒ‡ãƒ¼ã‚¿ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã‘ã‚Œã°ä¸­æ–­
  if (lunchList.length === 0) return;

  // ã‚¬ãƒãƒ£å›è»¢é–‹å§‹
  isSpinning = true;
  button.disabled = true;

  // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œã€çµæœè¡¨ç¤ºå‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
const message =
  spinningMessages[Math.floor(Math.random() * spinningMessages.length)];

document.getElementById("shop").textContent = message;
document.getElementById("comment").textContent = "";
  // åˆå›ã§ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
result.classList.add("show");

  // å°‘ã—å¾…ã£ã¦ã‹ã‚‰çµæœã‚’è¡¨ç¤ºï¼ˆã‚¬ãƒãƒ£æ¼”å‡ºï¼‰
  setTimeout(() => {
  let shop;

  // å‰å›ã¨åŒã˜åº—ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
  do {
    shop = lunchList[Math.floor(Math.random() * lunchList.length)];
  } while (shop.name === lastShop);

  const comment =
    shop.comments[Math.floor(Math.random() * shop.comments.length)];

  document.getElementById("shop").textContent = shop.name;
  document.getElementById("comment").textContent = comment;

  // çµæœãµã‚ã£ã¨è¡¨ç¤º
  result.classList.add("show");

  // ãƒœã‚¿ãƒ³ã·ã‚‹ã·ã‚‹åœæ­¢
  button.classList.remove("spinning");

  // ä»Šå›ã®åº—ã‚’ä¿å­˜
  lastShop = shop.name;

  isSpinning = false;
  button.disabled = false;
}, 1300); // 1.3ç§’å¾…ã¤
});
